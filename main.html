<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
  <title>Голосовые заметки</title>
  <meta charset="UTF-8">
</head>
<body>
  <h1>Голосовые заметки</h1>

  <div id="container">
    <button id="recordButton">Начать запись</button>
    <div id="note-text" placeholder="Ваша заметка..."></div>

    <div id="reminder-settings">
      <label for="reminder-time">Напомнить в:</label>
      <input type="datetime-local" id="reminder-time">
      <button id="setReminder">Установить напоминание</button>
    </div>
  </div>

  <script>
    const recordButton = document.getElementById('recordButton');
    const noteText = document.getElementById('note-text');
    const reminderSettings = document.getElementById('reminder-settings');
    const reminderTimeInput = document.getElementById('reminder-time');
    const setReminderButton = document.getElementById('setReminder');

    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];

    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };

        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
          const audioUrl = URL.createObjectURL(audioBlob);
          sendAudioToSpeechRecognition(audioUrl);
        };

        recordButton.addEventListener('click', () => {
          if (isRecording) {
            mediaRecorder.stop();
            recordButton.textContent = 'Начать запись';
            isRecording = false;
            reminderSettings.style.display = 'block';
          } else {
            audioChunks = [];
            mediaRecorder.start();
            recordButton.textContent = 'Остановить запись';
            isRecording = true;
          }
        });
      })
      .catch(err => {
        console.error('Ошибка при получении доступа к микрофону:', err);
        alert('Ошибка при получении доступа к микрофону. Пожалуйста, проверьте настройки вашего браузера.');
      });

    function sendAudioToSpeechRecognition(audioUrl) {
      // Здесь нужно добавить ваш код для отправки audioUrl на сервер
      // для распознавания речи и получения текста заметки.
      // Пример:
      // fetch('/api/speech-to-text', {
      //   method: 'POST',
      //   body: audioBlob
      // })
      // .then(response => response.text())
      // .then(text => {
      //   noteText.value = text;
      // })
      // .catch(err => {
      //   console.error('Ошибка при распознавании речи:', err);
      // });
    }

    setReminderButton.addEventListener('click', () => {
      const reminderTime = new Date(reminderTimeInput.value);
      const now = new Date();
      const timeUntilReminder = reminderTime - now;

      if (timeUntilReminder > 0) {
        setTimeout(() => {
          alert(`Напоминание: ${noteText.value}`);
        }, timeUntilReminder);

        alert(`Напоминание установлено на ${reminderTime.toLocaleString()}.`);
      } else {
        alert('Пожалуйста, выберите время в будущем.');
      }
    });
  </script>
</body>
</html>
